# 공통 (default)
server:
  port: ${PORT:8000}

spring:
  application:
    name: gateway-server
  cloud:
    gateway:
      routes:
        - id: budget-server-route
          # eureka client 등록 및 의존성으로 인해 자동으로 eureka-server를 찾음
          # eureka-server 서버로 budget-server의 host를 질의함
          uri: lb://budget-server
          predicates:
            - Path=/budget/**
        - id: budget-server-apidocs
          uri: lb://budget-server
          predicates:
            - Path=/apidocs/budget-server/**
          filters:
            # ${segment}는 YAML에서 EL로 인식되므로 백슬래시로 이스케이프 필요
            # ex) /apidocs/budget-server/index.html -> /docs/index.html
            - RewritePath=/apidocs/budget-server/(?<segment>.*), /docs/\${segment}

eureka:
  client:
    service-url:
      defaultZone: ${EUREKA_SERVER_URL:http://localhost:8761/eureka}
  instance:
    instance-id: ${spring.application.name}:${random.value}

gateway:
  secret: ${GATEWAY_SECRET}

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
  metrics:
    tags:
      application: ${spring.application.name}

---

# local
spring:
  config:
    activate:
      on-profile: local

logging:
  level:
    org.springframework.cloud.gateway: TRACE
    reactor.netty.http.client: DEBUG
    reactor.netty.http.server: DEBUG

---

# prod
spring:
  config:
    activate:
      on-profile: prod

eureka:
  instance:
    hostname: ${RENDER_EXTERNAL_HOSTNAME}
    prefer-ip-address: false
    instance-id: ${spring.application.name}:${random.value}

# prod에서는 과도한 디버그를 줄이고 INFO 중심으로 설정
logging:
  level:
    root: INFO
    org.springframework.cloud.gateway: INFO
    reactor.netty.http.client: INFO
    reactor.netty.http.server: INFO